## 트랜잭션

> 데이터의 정합성 및 작업의 완전성을 보장하는 하나의 단위
> 

트랜잭션은 데이터베이스에서 데이터를 일관되고 안전하게 다루기 위해 사용하는 작업 단위이다. 트랜잭션이 필요한 이유는 시스템에서 발생할 수 있는 오류나 중단 상황에도 데이터의 정합성과 작업의 완전성을 보장하기 위해서이다. 트랜잭션이 제대로 관리되지 않으면 데이터 무결성이 손상되거나 작업의 일관성이 깨질 수 있다.

## 트랜잭션의 특성(ACID)

- **Atomicity (원자성)**
    - 트랜잭션 내 모든 작업이 성공하거나, 실패 시 모든 작업이 취소(롤백)되어야 한다. 즉, 작업이 더 이상 나눠질 수 없는 하나의 단위로 처리된다.
- **Consistency (일관성)**
    - 트랜잭션은 데이터베이스의 일관성 규칙을 준수해야 하며, 시작 전후로 데이터베이스는 일관된 상태여야 한다. 만약 트랜잭션이 데이터베이스의 규칙을 위반하면 롤백된다.
    - DB 규칙뿐만 아니라 애플리케이션에서 정의한 비즈니스 규칙도 일관성 유지에 포함된다.
- **Isolation (고립성)**
    - 여러 트랜잭션이 동시에 수행될 때 서로의 작업에 영향을 주지 않도록 고립되어야 한다. 즉, 각 트랜잭션이 독립적으로 실행된 것처럼 보여야 한다.
    - 고립성을 유지하는 수준은 **Isolation Level**을 통해 설정할 수 있다.
- **Durability (영속성)**
    - 커밋된 트랜잭션의 결과는 영구적으로 데이터베이스에 저장된다. 시스템에 장애가 발생하더라도 커밋된 데이터는 손실되지 않는다.

## **트랜잭션 격리 수준**

하나의 트랜잭션 내에서 또는 여러 트랜잭션 간의 작업 내용을 어떻게 공유하고 차단할 것인지를 결정하는 레벨

### 1. **Serializable**

- 특징: 가장 엄격한 격리 수준으로, 트랜잭션이 순차적으로 실행된다.
- 장점: 데이터 일관성이 매우 높아 데이터 부정합 문제가 발생하지 않는다.
- 단점: 동시 처리가 어려워 성능이 떨어진다. 단순한 조회(SELECT) 작업도 읽기 잠금이 걸리며, 여러 트랜잭션이 순차 실행되므로 성능에 큰 영향을 준다.

### 2. **Repeatable Read**

- 특징: 트랜잭션이 시작된 후 데이터가 변경되지 않도록 보장하여 Non-Repeatable Read를 방지한다.
- 작동 방식: MVCC(다중 버전 동시성 제어) 기법을 사용하여 트랜잭션 중간에 다른 트랜잭션이 데이터를 수정해도 처음에 조회한 상태를 유지한다. 이를 위해 변경 전 데이터를 언두 로그에 저장한다.
- 한계: Phantom Read는 방지하지 못해, 트랜잭션 중간에 새로운 레코드가 추가되거나 삭제될 수 있다.

### **3. Read Committed**

- **특징**: 트랜잭션이 커밋된 데이터만 조회할 수 있도록 보장하는 격리 수준이다.
- **장점**: Non-Repeatable Read는 발생할 수 있지만, Dirty Read는 방지할 수 있다.
- **한계**: 하나의 트랜잭션에서 동일한 데이터를 여러 번 조회할 때 중간에 다른 트랜잭션이 데이터를 수정하면 다른 값이 나올 수 있다. 즉, Non-Repeatable Read가 발생할 가능성이 있다.

### **4. Read Uncommitted**

- **특징**: 커밋되지 않은, 즉 아직 확정되지 않은 데이터를 읽을 수 있는 가장 낮은 격리 수준이다.
- **문제점**: Dirty Read가 발생할 수 있다. 다른 트랜잭션이 아직 커밋하지 않은 변경사항을 읽게 되면 데이터 일관성이 깨질 수 있다.
- **주의사항**: RDBMS 표준에서도 추천하지 않을 만큼 데이터 정합성 문제가 많다. 그래서 MySQL 같은 데이터베이스에서는 최소한 **Read Committed** 이상의 격리 수준을 사용해야 해야 한다.