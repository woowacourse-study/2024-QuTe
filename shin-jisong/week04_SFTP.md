# SFTP 프로토콜 개요

## 소개
SFTP(Secure File Transfer Protocol)는 원격 시스템 간에 파일을 전송하기 위해 보안이 적용된 네트워크 프로토콜로, SSH(Secure Shell) 연결을 통해 파일 데이터와 명령어를 안전하게 전송합니다. 데이터 전송 시 암호화가 적용되지 않는 FTP(File Transfer Protocol)와 달리, SFTP는 전송 중 데이터와 명령어를 암호화하여 보안을 강화합니다.

## SFTP 원리
- **SSH 암호화**: SFTP는 SSH 프로토콜을 통해 인증과 데이터 전송을 모두 보호하며, 암호화된 연결을 제공합니다.
- **인증**: 파일 전송 전, 사용자는 보통 비밀번호, SSH 키, 또는 다중 인증을 통해 인증을 거칩니다.
- **암호화**: 파일 내용, 명령어, 파일 이름까지 모든 데이터가 암호화되어 민감한 정보가 노출되지 않습니다.
- **단일 연결**: 여러 개의 연결을 사용하는 FTP와 달리, SFTP는 모든 상호작용을 단일 보안 연결로 유지합니다.

## SFTP 파일 전송 과정

### 1. 연결 설정
   - 클라이언트는 기본 SSH 포트인 22번 포트로 서버에 연결을 요청합니다.
   - 서버는 SSH 공개 키를 제공하고, 클라이언트는 이를 확인하여 서버의 신뢰성을 검증합니다.

### 2. 인증
   - **비밀번호 인증**: 클라이언트는 사용자 이름과 비밀번호를 암호화하여 서버로 전송합니다.
   - **키 기반 인증**: 또는 SSH 키를 사용하여 인증할 수 있으며, 이는 비밀번호보다 더 안전합니다.
   - 서버는 자격 증명을 확인하고 성공 시 세션을 설정합니다.

### 3. SFTP 세션 시작
   - 인증이 완료되면, 클라이언트는 SSH 연결을 통해 SFTP 세션을 시작합니다.
   - 클라이언트와 서버는 지원되는 프로토콜을 협상하여 허용된 파일 처리 작업(예: 읽기, 쓰기, 삭제)을 정의합니다.

### 4. 파일 전송
   - 클라이언트는 암호화된 연결을 통해 서버에 파일 업로드 또는 다운로드 명령을 보냅니다.
   - **업로드**: 클라이언트는 파일을 패킷으로 나누어 SSH를 통해 전송하고, 서버는 수신할 때마다 각 패킷을 확인합니다.
   - **다운로드**: 서버는 동일한 방식으로 파일을 패킷 단위로 나누어 클라이언트에 전송합니다.
   - 패킷 기반 전송은 수신자가 각 패킷 도착 시 무결성을 확인할 수 있게 해줍니다.

### 5. 확인 및 응답
   - 각 패킷 전송 시 수신자는 무결성을 확인하고 다음 패킷 준비 완료를 신호로 보냅니다.
   - 오류가 감지되면 해당 패킷은 재전송됩니다.

### 6. 세션 종료
   - 파일 전송이 완료되면, 클라이언트는 SFTP 연결 종료 명령을 보내 세션을 종료합니다.
   - 서버는 연결을 닫으며 보안 세션이 끝납니다.

## SFTP의 장점
- **데이터 보안**: 모든 데이터와 명령이 암호화되어 가로채기 방지가 가능합니다.
- **방화벽 호환성**: SSH 포트 22번을 사용하여 방화벽 문제를 피할 수 있습니다.
- **신뢰성**: 패킷 확인 및 체크섬으로 높은 전송 무결성을 제공합니다.

## 결론
SFTP는 다양한 환경에서 안전한 파일 전송을 위해 널리 사용되며, 특히 민감한 데이터가 관련된 경우 선호됩니다. SSH 암호화와 단일 연결 구조를 기반으로 안전한 파일 처리를 보장합니다.
